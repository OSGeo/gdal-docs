

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Vector driver in Python implementation tutorial &mdash; GDAL  documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://gdal.orgtutorials/vector_python_driver.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/gdal.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GNM API tutorial" href="gnm_api_tut.html" />
    <link rel="prev" title="Vector driver implementation tutorial" href="vector_driver_tut.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/gdalicon.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/index.html">Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/raster/index.html">Raster drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/vector/index.html">Vector drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#raster">Raster</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#multidimensional-raster">Multidimensional raster</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#vector">Vector</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="vector_api_tut.html">Vector API tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="vector_driver_tut.html">Vector driver implementation tutorial</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Vector driver in Python implementation tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linking-mechanism-to-a-python-interpreter">Linking mechanism to a Python interpreter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#driver-location">Driver location</a></li>
<li class="toctree-l4"><a class="reference internal" href="#import-section">Import section</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metadata-section">Metadata section</a></li>
<li class="toctree-l4"><a class="reference internal" href="#driver-class">Driver class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dataset-class">Dataset class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layer-class">Layer class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#full-example">Full example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-examples">Other examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#geographic-network-model">Geographic Network Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#projections-and-spatial-reference-systems-tutorial-osr-ogrspatialreference">Projections and Spatial Reference Systems tutorial (OSR - OGRSpatialReference)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">How to contribute?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GDAL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html"> GDAL  documentation </a> &raquo;</li>
      
          <li><a href="index.html">Tutorials</a> &raquo;</li>
      
      <li>Vector driver in Python implementation tutorial</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSGeo/gdal/edit//master/gdal/doc/source/tutorials/vector_python_driver.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="gnm_api_tut.html" class="btn btn-neutral float-right" title="GNM API tutorial" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="vector_driver_tut.html" class="btn btn-neutral float-left" title="Vector driver implementation tutorial" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vector-driver-in-python-implementation-tutorial">
<span id="vector-python-driver-tut"></span><h1>Vector driver in Python implementation tutorial<a class="headerlink" href="#vector-driver-in-python-implementation-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Since GDAL 3.1, the capability of writing read-only vector drivers in Python
has been added. It is strongly advised to read the <a class="reference internal" href="vector_driver_tut.html#vector-driver-tut"><span class="std std-ref">Vector driver implementation tutorial</span></a> first,
which will give the general principles of how a vector driver works.</p>
<p>This capability does not require the use of the GDAL/OGR SWIG Python bindings
(but a vector Python driver may use them.)</p>
<p>Note: per project policies, this is considered as an “experimental” feature
and the GDAL project will not accept such Python drivers to be included in
the GDAL repository. Drivers aiming at inclusion in GDAL master should priorly
be ported to C++. The rationale for this is that:</p>
<ul class="simple">
<li><p>the correctness of the Python code can mostly be checked at runtime, whereas
C++ benefits from static analysis (at compile time, and other checkers).</p></li>
<li><p>Python code is executed under the Python Global Interpreter Lock, which makes
them not scale.</p></li>
<li><p>Not all builds of GDAL have Python available.</p></li>
</ul>
</div>
<div class="section" id="linking-mechanism-to-a-python-interpreter">
<h2>Linking mechanism to a Python interpreter<a class="headerlink" href="#linking-mechanism-to-a-python-interpreter" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="../drivers/raster/vrt.html#linking-mechanism-to-python-interpreter"><span class="std std-ref">Linking mechanism to a Python interpreter</span></a></p>
</div>
<div class="section" id="driver-location">
<h2>Driver location<a class="headerlink" href="#driver-location" title="Permalink to this headline">¶</a></h2>
<p>Driver filenames must start with <cite>gdal_</cite> or <cite>ogr_</cite> and have the <cite>.py</cite> extension.
They will be searched in the following directies:</p>
<ul class="simple">
<li><p>the directory pointed by the <code class="docutils literal notranslate"><span class="pre">GDAL_PYTHON_DRIVER_PATH</span></code> configuration option
(there may be several paths separated by <cite>:</cite> on Unix or <cite>;</cite> on Windows)</p></li>
<li><p>if not defined, the directory pointed by the <code class="docutils literal notranslate"><span class="pre">GDAL_DRIVER_PATH</span></code> configuration
option.</p></li>
<li><p>if not defined, in the directory (hardcoded at compilation time on Unix builds)
where native plugins are located.</p></li>
</ul>
<p>GDAL does not try to manage Python dependencies that are imported by the driver
.py script. It is up to the user to make sure its current Python environment
has all required dependencies installed.</p>
</div>
<div class="section" id="import-section">
<h2>Import section<a class="headerlink" href="#import-section" title="Permalink to this headline">¶</a></h2>
<p>Drivers must have the following import section to load the base classes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gdal_python_driver</span> <span class="kn">import</span> <span class="n">BaseDriver</span><span class="p">,</span> <span class="n">BaseDataset</span><span class="p">,</span> <span class="n">BaseLayer</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">gdal_python_driver</span></code> module is created dynamically by GDAL and is not
present on the file system.</p>
</div>
<div class="section" id="metadata-section">
<h2>Metadata section<a class="headerlink" href="#metadata-section" title="Permalink to this headline">¶</a></h2>
<p>In the first 1000 lines of the .py file, a number of required and optional
KEY=VALUE driver directives must be defined. They are parsed by C++ code,
without using the Python interpreter, so it is vital to respect the following
constraints:</p>
<ul class="simple">
<li><p>each declaration must be on a single line, and start with <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_</span></code>
(space character between sharp character and gdal, and between colon character and DRIVER_)</p></li>
<li><p>the value must be a literal value of type string (except for
# gdal: DRIVER_SUPPORTED_API_VERSION which can accept an array of integers),
without expressions, function calls, escape sequences, etc.</p></li>
<li><p>strings may be single or double-quoted</p></li>
</ul>
<p>The following directives must be declared:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_NAME</span></code> = “some_name”: the short name of the driver</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_SUPPORTED_API_VERSION</span></code> = [1]: the API version(s) supported by
the driver. Must include 1, which is the only currently supported version in GDAL 3.1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_DCAP_VECTOR</span></code> = “YES”: declares a vector driver</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_DMD_LONGNAME</span></code> = “a longer description of the driver”</p></li>
</ul>
<p>Additional directives:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_DMD_EXTENSIONS</span></code> = “ext1 ext2”: list of extension(s) recognized
by the driver, without the dot, and separated by space</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_DMD_HELPTOPIC</span></code> = “url_to_hep_page”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_DMD_OPENOPTIONLIST</span></code> = xml_value where xml_value is an OptionOptionList
specification, like “&lt;OpenOptionList&gt;&lt;Option name=’OPT1’ type=’boolean’ description=’bla’ default=’NO’/&gt;&lt;/OpenOptionList&gt;”**</p></li>
<li><p>and all other metadata items found in gdal.h starting with <cite>GDAL_DMD_</cite> (resp. <cite>GDAL_DCAP</cite>) by
creating an item name which starts with <cite># gdal: DRIVER_</cite> and the value of the
<cite>GDAL_DMD_</cite> (resp. <cite>GDAL_DCAP</cite>) metadata item.
For example <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">GDAL_DMD_CONNECTION_PREFIX</span> <span class="pre">&quot;DMD_CONNECTION_PREFIX&quot;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">gdal:</span> <span class="pre">DRIVER_DMD_CONNECTION_PREFIX</span></code></p></li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># gdal: DRIVER_NAME = &quot;DUMMY&quot;</span>
<span class="c1"># gdal: DRIVER_SUPPORTED_API_VERSION = [1]</span>
<span class="c1"># gdal: DRIVER_DCAP_VECTOR = &quot;YES&quot;</span>
<span class="c1"># gdal: DRIVER_DMD_LONGNAME = &quot;my super plugin&quot;</span>
<span class="c1"># gdal: DRIVER_DMD_EXTENSIONS = &quot;foo bar&quot;</span>
<span class="c1"># gdal: DRIVER_DMD_HELPTOPIC = &quot;http://example.com/my_help.html&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="driver-class">
<h2>Driver class<a class="headerlink" href="#driver-class" title="Permalink to this headline">¶</a></h2>
<p>The entry point .py script must contains a single class that inherits from
<code class="docutils literal notranslate"><span class="pre">gdal_python_driver.BaseDriver</span></code>.</p>
<p>That class must define the following methods:</p>
<dl class="function">
<dt>
<code class="descname">identify</code><span class="sig-paren">(</span><em>self</em>, <em>filename</em>, <em>first_bytes</em>, <em>open_flags</em>, <em>open_options={}</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – File name, or more generally, connection string.</p></li>
<li><p><strong>first_bytes</strong> (<em>binary</em>) – First bytes of the file (if it is a file).
At least 1024 (if the file has at least 1024 bytes), or more if a native driver in the driver probe sequence has requested more previously.</p></li>
<li><p><strong>open_flags</strong> (<em>int</em>) – Open flags. To be ignored for now.</p></li>
<li><p><strong>open_options</strong> (<em>dict</em>) – Open options.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the file is recognized by the driver, False if not, or -1
if that cannot be known from the first bytes.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">open</code><span class="sig-paren">(</span><em>self</em>, <em>filename</em>, <em>first_bytes</em>, <em>open_flags</em>, <em>open_options={}</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – File name, or more generally, connection string.</p></li>
<li><p><strong>first_bytes</strong> (<em>binary</em>) – First bytes of the file (if it is a file).
At least 1024 (if the file has at least 1024 bytes), or more if a native driver in the driver probe sequence has requested more previously.</p></li>
<li><p><strong>open_flags</strong> (<em>int</em>) – Open flags. To be ignored for now.</p></li>
<li><p><strong>open_options</strong> (<em>dict</em>) – Open options.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>an object deriving from gdal_python_driver.BaseDataset or None</p>
</dd>
</dl>
</dd></dl>

<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Required: class deriving from BaseDriver</span>
<span class="k">class</span> <span class="nc">Driver</span><span class="p">(</span><span class="n">BaseDriver</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">first_bytes</span><span class="p">,</span> <span class="n">open_flags</span><span class="p">,</span> <span class="n">open_options</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">return</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;DUMMY:&#39;</span>

    <span class="c1"># Required</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">first_bytes</span><span class="p">,</span> <span class="n">open_flags</span><span class="p">,</span> <span class="n">open_options</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">first_bytes</span><span class="p">,</span> <span class="n">open_flags</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dataset-class">
<h2>Dataset class<a class="headerlink" href="#dataset-class" title="Permalink to this headline">¶</a></h2>
<p>The Driver.open() method on success should return an object from a class that
inherits from <code class="docutils literal notranslate"><span class="pre">gdal_python_driver.BaseDataset</span></code>.</p>
<div class="section" id="layers">
<h3>Layers<a class="headerlink" href="#layers" title="Permalink to this headline">¶</a></h3>
<p>The role of this object is to store vector layers. There are two implementation
options. If the number of layers is small or they are fast to construct, then
the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method can defined a <code class="docutils literal notranslate"><span class="pre">layers</span></code> attribute that is a sequence of
objects from a class that inherits from <code class="docutils literal notranslate"><span class="pre">gdal_python_driver.BaseLayer</span></code>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Dataset</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Layer</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span>
</pre></div>
</div>
<p>Otherwise, the following two methods should be defined:</p>
<dl class="function">
<dt>
<code class="descname">layer_count</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the number of layers</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">layer</code><span class="sig-paren">(</span><em>self</em>, <em>idx</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>idx</strong> (<em>int</em>) – Index of the layer to return. Normally between 0 and
self.layer_count() - 1, but calling code might pass any
value. In case of invalid index, None should be returned.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>an object deriving from gdal_python_driver.BaseLayer or None.
The C++ code will take care of caching that object, and this method
will only be called once for a given idx value.</p>
</dd>
</dl>
</dd></dl>

<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Dataset</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">layer_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Layer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)]</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
<div class="section" id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p>The dataset may define a <code class="docutils literal notranslate"><span class="pre">metadata</span></code> dictionary, in <code class="docutils literal notranslate"><span class="pre">__init__</span></code> of
key: value of type string, for the default metadata domain.
Alternatively, the following method may be implemented.</p>
<dl class="function">
<dt>
<code class="descname">metadata</code><span class="sig-paren">(</span><em>self</em>, <em>domain</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>domain</strong> (<em>str</em>) – metadata domain. Empty string for the default one</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>None, or a dictionary of key:value pairs of type string;</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="other-methods">
<h3>Other methods<a class="headerlink" href="#other-methods" title="Permalink to this headline">¶</a></h3>
<p>The following method may be optionally implemented:</p>
<dl class="function">
<dt>
<code class="descname">close</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span></dt>
<dd><p>Called at the destruction of the C++ peer GDALDataset object. Useful
to close database connections for example.</p>
</dd></dl>

</div>
</div>
<div class="section" id="layer-class">
<h2>Layer class<a class="headerlink" href="#layer-class" title="Permalink to this headline">¶</a></h2>
<p>The Dataset object will instantiate one or several objects from a class that
inherits from <code class="docutils literal notranslate"><span class="pre">gdal_python_driver.BaseLayer</span></code>.</p>
<div class="section" id="metadata-and-other-definitions">
<h3>Metadata, and other definitions<a class="headerlink" href="#metadata-and-other-definitions" title="Permalink to this headline">¶</a></h3>
<p>The following attributes are required and must defined at __init__ time:</p>
<dl class="attribute">
<dt>
<code class="descname">name</code></dt>
<dd><p>Layer name, of type string. If not set, a <code class="docutils literal notranslate"><span class="pre">name</span></code> method must
be defined.</p>
</dd></dl>

<dl class="attribute">
<dt id="fields">
<code class="descname">fields</code><a class="headerlink" href="#fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Sequence of field definitions (may be empty).
Each field is a dictionary with the following properties:</p>
<dl class="attribute">
<dt>
<code class="descname">name</code></dt>
<dd><p>Required</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">type</code></dt>
<dd><p>A integer value of type ogr.OFT_ (from the SWIG Python bindings), or
one of the following string values: <code class="docutils literal notranslate"><span class="pre">String</span></code>, <code class="docutils literal notranslate"><span class="pre">Integer</span></code>, <code class="docutils literal notranslate"><span class="pre">Integer16</span></code>, <code class="docutils literal notranslate"><span class="pre">Integer64</span></code>,
<code class="docutils literal notranslate"><span class="pre">Boolean</span></code>, <code class="docutils literal notranslate"><span class="pre">Real</span></code>, <code class="docutils literal notranslate"><span class="pre">Float</span></code>, <code class="docutils literal notranslate"><span class="pre">Binary</span></code>, <code class="docutils literal notranslate"><span class="pre">Date</span></code>, <code class="docutils literal notranslate"><span class="pre">Time</span></code>, <code class="docutils literal notranslate"><span class="pre">DateTime</span></code></p>
</dd></dl>

<p>If that attribute is not set, a <code class="docutils literal notranslate"><span class="pre">fields</span></code> method must be defined and
return such a sequence.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">geometry_fields</code></dt>
<dd><p>Sequence of geometry field definitions (may be empty).
Each field is a dictionary with the following properties:</p>
<dl class="attribute">
<dt>
<code class="descname">name</code></dt>
<dd><p>Required. May be empty</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">type</code></dt>
<dd><p>Required. A integer value of type ogr.wkb_ (from the SWIG Python bindings), or
one of the following string values: <code class="docutils literal notranslate"><span class="pre">Unknown</span></code>, <code class="docutils literal notranslate"><span class="pre">Point</span></code>, <code class="docutils literal notranslate"><span class="pre">LineString</span></code>,
<code class="docutils literal notranslate"><span class="pre">Polygon</span></code>, <code class="docutils literal notranslate"><span class="pre">MultiPoint</span></code>, <code class="docutils literal notranslate"><span class="pre">MultiLineString</span></code>, <code class="docutils literal notranslate"><span class="pre">MultiPolygon</span></code>,
<code class="docutils literal notranslate"><span class="pre">GeometryCollections</span></code> or all other values returned by <a class="reference internal" href="../api/vector_c_api.html#_CPPv421OGRGeometryTypeToName18OGRwkbGeometryType" title="OGRGeometryTypeToName"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRGeometryTypeToName()</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">srs</code></dt>
<dd><p>The SRS attached to the geometry field as a string that can be ingested by
<a class="reference internal" href="../api/ogrspatialref.html#_CPPv4N19OGRSpatialReference16SetFromUserInputEPKc" title="OGRSpatialReference::SetFromUserInput"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRSpatialReference::SetFromUserInput()</span></code></a>, such as a PROJ string,
WKT string, or AUTHORITY:CODE.</p>
</dd></dl>

<p>If that attribute is not set, a <code class="docutils literal notranslate"><span class="pre">geometry_fields</span></code> method must be defined and
return such a sequence.</p>
</dd></dl>

<p>The following attributes are optional:</p>
<dl class="attribute">
<dt>
<code class="descname">fid_name</code></dt>
<dd><p>Feature ID column name, of type string. May be empty string. If not set,
a <code class="docutils literal notranslate"><span class="pre">fid_name</span></code> method may be defined.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">metadata</code></dt>
<dd><p>A dictionary of key: value strings, corresponding to metadata of the default
metadata domain. Alternatively, a <code class="docutils literal notranslate"><span class="pre">metadata</span></code> method that accepts a domain
argument may be defined.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">iterator_honour_attribute_filter</code></dt>
<dd><p>Can be set to True if the feature iterator takes into account the
<code class="docutils literal notranslate"><span class="pre">attribute_filter</span></code> attribute that can be set on the layer.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">iterator_honour_spatial_filter</code></dt>
<dd><p>Can be set to True if the feature iterator takes into account the
<code class="docutils literal notranslate"><span class="pre">spatial_filter</span></code> attribute that can be set on the layer.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">feature_count_honour_attribute_filter</code></dt>
<dd><p>Can be set to True if the feature_count method takes into account the
<code class="docutils literal notranslate"><span class="pre">attribute_filter</span></code> attribute that can be set on the layer.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">feature_count_honour_spatial_filter</code></dt>
<dd><p>Can be set to True if the feature_count method takes into account the
<code class="docutils literal notranslate"><span class="pre">spatial_filter</span></code> attribute that can be set on the layer.</p>
</dd></dl>

</div>
<div class="section" id="feature-iterator">
<h3>Feature iterator<a class="headerlink" href="#feature-iterator" title="Permalink to this headline">¶</a></h3>
<p>The Layer class must implement the iterator interface, so typically with
a <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> method.</p>
<p>The iterator must return a dictionary with the feature content.</p>
<p>Two keys allowed in the returned dictionary are:</p>
<dl class="attribute">
<dt>
<code class="descname">id</code></dt>
<dd><p>Strongly recommended. The value must be of type int to be recognized as a FID by GDAL</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">type</code></dt>
<dd><p>Required. The value must be the string “OGRFeature”</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">fields</code></dt>
<dd><p>Required. The value must be a dictionary whose keys are field names, or None</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">geometry_fields</code></dt>
<dd><p>Required. the value must be a dictionary whose keys are geometry field names (possibly
the empty string for unnamed geometry columns), or None.
The value of each key must be a geometry encoded as WKT, or None.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">style</code></dt>
<dd><p>Optional. The value must be a string conforming to the <a class="reference internal" href="../user/ogr_feature_style.html#ogr-feature-style"><span class="std std-ref">Feature Style Specification</span></a>.</p>
</dd></dl>

</div>
<div class="section" id="filtering">
<h3>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h3>
<p>By default, any attribute or spatial filter set by the user of the OGR API will
be evaluated by the generic C++ side of the driver, by iterating over all features of the
layer.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">iterator_honour_attribute_filter</span></code> (resp. <code class="docutils literal notranslate"><span class="pre">iterator_honour_spatial_filter</span></code>)
attribute of the layer object is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the attribute filter (resp.
spatial filter) must be honoured by the feature iterator method.</p>
<p>The attribute filter is set in the <code class="docutils literal notranslate"><span class="pre">attribute_filter</span></code> attribute of the
layer object. It is a string conforming to <a class="reference internal" href="../user/ogr_sql_dialect.html#ogr-sql-dialect"><span class="std std-ref">OGR SQL</span></a>.
When the attribute filter is changed by the OGR API, the <code class="docutils literal notranslate"><span class="pre">attribute_filter_changed</span></code>
optional method is called (see below paragraph about optional methods).
An implementation of <code class="docutils literal notranslate"><span class="pre">attribute_filter_changed</span></code> may decide to fallback on
evaluation by the generic C++ side of the driver by calling the <code class="docutils literal notranslate"><span class="pre">SetAttributeFilter</span></code>
method (see below passthrough example)</p>
<p>The geometry filter is set in the <code class="docutils literal notranslate"><span class="pre">spatial_filter</span></code> attribute of the
layer object. It is a string encoding as ISO WKT. It is the responsibility of
the user of the OGR API to express it in the CRS of the layer.
When the attribute filter is changed by the OGR API, the <code class="docutils literal notranslate"><span class="pre">spatial_filter_changed</span></code>
optional method is called (see below paragraph about optional methods).
An implementation of <code class="docutils literal notranslate"><span class="pre">spatial_filter_changed</span></code> may decide to fallback on
evaluation by the generic C++ side of the driver by calling the <code class="docutils literal notranslate"><span class="pre">SetSpatialFilter</span></code>
method (see below passthrough example)</p>
</div>
<div class="section" id="optional-methods">
<h3>Optional methods<a class="headerlink" href="#optional-methods" title="Permalink to this headline">¶</a></h3>
<p>The following methods may be optionally implemented:</p>
<dl class="function">
<dt>
<code class="descname">extent</code><span class="sig-paren">(</span><em>self</em>, <em>force_computation</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the list [xmin,ymin,xmax,ymax] with the spatial extent of the layer.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">feature_count</code><span class="sig-paren">(</span><em>self</em>, <em>force_computation</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the number of features of the layer.</p>
</dd>
</dl>
<p>If self.feature_count_honour_attribute_filter or self.feature_count_honour_spatial_filter
are set to True, the attribute filter and/or spatial filter must be honoured
by this method.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">feature_by_id</code><span class="sig-paren">(</span><em>self</em>, <em>fid</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>fid</strong> (<em>int</em>) – feature ID</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a feature object in one of the formats of the <code class="docutils literal notranslate"><span class="pre">__next__</span></code> method
described above, or None if no object matches fid</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">attribute_filter_changed</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span></dt>
<dd><p>This method is called whenever self.attribute_filter has been changed.
It is the opportunity for the driver to potentially chane the value of
self.iterator_honour_attribute_filter or feature_count_honour_attribute_filter
attributes.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">spatial_filter_changed</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span></dt>
<dd><p>This method is called whenever self.spatial_filter has been changed (its value
is a geometry encoded in WKT)
It is the opportunity for the driver to potentially chane the value of
self.iterator_honour_spatial_filter or feature_count_honour_spatial_filter
attributes.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">test_capability</code><span class="sig-paren">(</span><em>self</em>, <em>cap</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>string</strong> (<em>cap</em>) – potential values are BaseLayer.FastGetExtent,
BaseLayer.FastSpatialFilter, BaseLayer.FastFeatureCount,
BaseLayer.RandomRead, BaseLayer.StringsAsUTF8 or
other strings supported by <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer14TestCapabilityEPKc" title="OGRLayer::TestCapability"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::TestCapability()</span></code></a></p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the capability is supported, False otherwise.</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="full-example">
<h2>Full example<a class="headerlink" href="#full-example" title="Permalink to this headline">¶</a></h2>
<p>The following example is a passthrough driver that forwards the calls to the
SWIG Python GDAL API. It has no practical use, and is just intended to show
case most possible uses of the API. A real-world driver will only use part of the
API demonstrated. For example, the passthrough driver implements attribute and
spatial filters in a completely dummy way, by calling back the C++ part of the
driver. The <code class="docutils literal notranslate"><span class="pre">iterator_honour_attribute_filter</span></code> and <code class="docutils literal notranslate"><span class="pre">iterator_honour_spatial_filter</span></code>
attributes, and the <code class="docutils literal notranslate"><span class="pre">attribute_filter_changed</span></code> and <code class="docutils literal notranslate"><span class="pre">spatial_filter_changed</span></code>
method implementations, could have omitted with the same result.</p>
<p>The connection strings recognized by the drivers are
“PASSHTROUGH:connection_string_supported_by_non_python_drivers”. Note that
the prefixing by the driver name is absolutely not a requirement, but something
specific to this particular driver which is a bit artificial (without the prefix,
the connection string would go directly to the native driver). The CityJSON
driver mentioned in the <a class="reference internal" href="#other-examples"><span class="std std-ref">Other examples</span></a> paragraph does
not need it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># This code is in the public domain, so as to serve as a template for</span>
<span class="c1"># real-world plugins.</span>
<span class="c1"># or, at the choice of the licensee,</span>
<span class="c1"># Copyright 2019 Even Rouault</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>

<span class="c1"># gdal: DRIVER_NAME = &quot;PASSTHROUGH&quot;</span>
<span class="c1"># API version(s) supported. Must include 1 currently</span>
<span class="c1"># gdal: DRIVER_SUPPORTED_API_VERSION = [1]</span>
<span class="c1"># gdal: DRIVER_DCAP_VECTOR = &quot;YES&quot;</span>
<span class="c1"># gdal: DRIVER_DMD_LONGNAME = &quot;Passthrough driver&quot;</span>
<span class="c1"># gdal: DRIVER_DMD_CONNECTION_PREFIX = &quot;PASSTHROUGH:&quot;</span>

<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">ogr</span>

<span class="kn">from</span> <span class="nn">gdal_python_driver</span> <span class="kn">import</span> <span class="n">BaseDriver</span><span class="p">,</span> <span class="n">BaseDataset</span><span class="p">,</span> <span class="n">BaseLayer</span>

<span class="k">class</span> <span class="nc">Layer</span><span class="p">(</span><span class="n">BaseLayer</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdal_layer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span> <span class="o">=</span> <span class="n">gdal_layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">gdal_layer</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fid_name</span> <span class="o">=</span> <span class="n">gdal_layer</span><span class="o">.</span><span class="n">GetFIDColumn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">gdal_layer</span><span class="o">.</span><span class="n">GetMetadata_Dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterator_honour_attribute_filter</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterator_honour_spatial_filter</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_count_honour_attribute_filter</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_count_honour_spatial_filter</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">layer_defn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer_defn</span><span class="o">.</span><span class="n">GetFieldCount</span><span class="p">()):</span>
            <span class="n">ogr_field_def</span> <span class="o">=</span> <span class="n">layer_defn</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">field_def</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">ogr_field_def</span><span class="o">.</span><span class="n">GetName</span><span class="p">(),</span>
                         <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ogr_field_def</span><span class="o">.</span><span class="n">GetType</span><span class="p">()}</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_def</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">geometry_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">layer_defn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer_defn</span><span class="o">.</span><span class="n">GetGeomFieldCount</span><span class="p">()):</span>
            <span class="n">ogr_field_def</span> <span class="o">=</span> <span class="n">layer_defn</span><span class="o">.</span><span class="n">GetGeomFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">field_def</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">ogr_field_def</span><span class="o">.</span><span class="n">GetName</span><span class="p">(),</span>
                         <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ogr_field_def</span><span class="o">.</span><span class="n">GetType</span><span class="p">()}</span>
            <span class="n">srs</span> <span class="o">=</span> <span class="n">ogr_field_def</span><span class="o">.</span><span class="n">GetSpatialRef</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">srs</span><span class="p">:</span>
                <span class="n">field_def</span><span class="p">[</span><span class="s2">&quot;srs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">()</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_def</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">test_capability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cap</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cap</span> <span class="ow">in</span> <span class="p">(</span><span class="n">BaseLayer</span><span class="o">.</span><span class="n">FastGetExtent</span><span class="p">,</span> <span class="n">BaseLayer</span><span class="o">.</span><span class="n">StringsAsUTF8</span><span class="p">,</span>
                <span class="n">BaseLayer</span><span class="o">.</span><span class="n">RandomRead</span><span class="p">,</span> <span class="n">BaseLayer</span><span class="o">.</span><span class="n">FastFeatureCount</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">TestCapability</span><span class="p">(</span><span class="n">cap</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_computation</span><span class="p">):</span>
        <span class="c1"># Impedance mismatch between SWIG GetExtent() and the Python</span>
        <span class="c1"># driver API</span>
        <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">GetExtent</span><span class="p">(</span><span class="n">force_computation</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">feature_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_computation</span><span class="p">):</span>
        <span class="c1"># Dummy implementation: we call back the generic C++ implementation</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">attribute_filter_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Dummy implementation: we call back the generic C++ implementation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute_filter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">SetAttributeFilter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attribute_filter</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">SetAttributeFilter</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">spatial_filter_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Dummy implementation: we call back the generic C++ implementation</span>
        <span class="c1"># the &#39;inf&#39; test is just for a test_ogrsf oddity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_filter</span> <span class="ow">and</span> <span class="s1">&#39;inf&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_filter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">SetSpatialFilter</span><span class="p">(</span>
                <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_filter</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">SetSpatialFilter</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_translate_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ogr_f</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">layer_defn</span> <span class="o">=</span> <span class="n">ogr_f</span><span class="o">.</span><span class="n">GetDefnRef</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ogr_f</span><span class="o">.</span><span class="n">GetFieldCount</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">ogr_f</span><span class="o">.</span><span class="n">IsFieldSet</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">layer_defn</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()]</span> <span class="o">=</span> <span class="n">ogr_f</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">geom_fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ogr_f</span><span class="o">.</span><span class="n">GetGeomFieldCount</span><span class="p">()):</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">ogr_f</span><span class="o">.</span><span class="n">GetGeomFieldRef</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">g</span><span class="p">:</span>
                <span class="n">geom_fields</span><span class="p">[</span><span class="n">layer_defn</span><span class="o">.</span><span class="n">GetGeomFieldDefn</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ExportToIsoWkt</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ogr_f</span><span class="o">.</span><span class="n">GetFID</span><span class="p">(),</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;OGRFeature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="n">ogr_f</span><span class="o">.</span><span class="n">GetStyleString</span><span class="p">(),</span>
                <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                <span class="s1">&#39;geometry_fields&#39;</span><span class="p">:</span> <span class="n">geom_fields</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_feature</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">feature_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fid</span><span class="p">):</span>
        <span class="n">ogr_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdal_layer</span><span class="o">.</span><span class="n">GetFeature</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ogr_f</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_feature</span><span class="p">(</span><span class="n">ogr_f</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Dataset</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdal_ds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdal_ds</span> <span class="o">=</span> <span class="n">gdal_ds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Layer</span><span class="p">(</span><span class="n">gdal_ds</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gdal_ds</span><span class="o">.</span><span class="n">GetLayerCount</span><span class="p">())]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">gdal_ds</span><span class="o">.</span><span class="n">GetMetadata_Dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdal_ds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdal_ds</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">class</span> <span class="nc">Driver</span><span class="p">(</span><span class="n">BaseDriver</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_identify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;PASSTHROUGH:&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OpenEx</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):],</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OF_VECTOR</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">first_bytes</span><span class="p">,</span> <span class="n">open_flags</span><span class="p">,</span> <span class="n">open_options</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">first_bytes</span><span class="p">,</span> <span class="n">open_flags</span><span class="p">,</span> <span class="n">open_options</span><span class="o">=</span><span class="p">{}):</span>
        <span class="n">gdal_ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gdal_ds</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">gdal_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="other-examples">
<span id="id1"></span><h2>Other examples<a class="headerlink" href="#other-examples" title="Permalink to this headline">¶</a></h2>
<p>Other examples, including a CityJSON driver, may be found at
<a class="reference external" href="https://github.com/OSGeo/gdal/tree/master/gdal/examples/pydrivers">https://github.com/OSGeo/gdal/tree/master/gdal/examples/pydrivers</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gnm_api_tut.html" class="btn btn-neutral float-right" title="GNM API tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="vector_driver_tut.html" class="btn btn-neutral float-left" title="Vector driver implementation tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <div class="info">
      <a class="logo-link" href="https://osgeo.org">
        <div class="osgeo-logo"></div>
      </a>
      <div class="copyright">
      

      &copy; 1998-2020 <a href="https://github.com/warmerdam">Frank Warmerdam</a>,
      <a href="https://github.com/rouault">Even Rouault</a>, and
      <a href="https://github.com/OSGeo/gdal/graphs/contributors">others</a>


      
      </div>
    </div>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>