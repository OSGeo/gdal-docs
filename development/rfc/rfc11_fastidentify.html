

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>RFC 11: Fast Format Identification &mdash; GDAL  documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://gdal.orgdevelopment/rfc/rfc11_fastidentify.html"/>
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/gdal.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="RFC 12: Improved File Management" href="rfc12_filemanagement.html" />
    <link rel="prev" title="RFC 10: OGR Open Parameters" href="rfc10_ogropen.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/gdalicon.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programs/index.html">Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers/raster/index.html">Raster drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers/vector/index.html">Vector drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Development</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">RFC list</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="rfc1_pmc.html">RFC 1: Project Management Committee Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc2_svn.html">RFC 2: Migration to OSGeo Subversion Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc3_commiters.html">RFC 3: GDAL Committer Guildlines</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc4_geolocate.html">RFC 4: Geolocation Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc5_unicode.html">RFC 5: Unicode support in GDAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc6_sqlgeom.html">RFC 6: Geometry and Feature Style as OGR Special Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc7_vsilapi.html">RFC 7: Use VSILFILE for VSI*L Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc8_devguide.html">RFC 8: Developer Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc9_maintainer.html">RFC 9: GDAL Paid Maintainer Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc10_ogropen.html">RFC 10: OGR Open Parameters</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">RFC 11: Fast Format Identification</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gdalopeninfo">GDALOpenInfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#identify">Identify()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#driver-changes">Driver Changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cplreaddir">CPLReadDir()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compatibility">Compatibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="#swig-implications">SWIG Implications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#regression-testing">Regression Testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation-plan">Implementation Plan</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance-tests">Performance Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rfc12_filemanagement.html">RFC 12: Improved File Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc13_createfeatures.html">RFC 13: Improved Feature Insertion/Update/Delete Performance in Batch Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc14_imagestructure.html">RFC 14: Image Structure Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc15_nodatabitmask.html">RFC 15: Band Masks</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc16_ogr_reentrancy.html">RFC 16: OGR Thread Safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc17_python_namespaces.html">RFC 17: Python Namespaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc18_ogr_styles_c_api.html">RFC 18: OGR Style Support in C API</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc19_safememalloc.html">RFC 19: Safer memory allocation in GDAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc20_srs_axes.html">RFC 20: OGRSpatialReference Axis Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc21_ogrsqlcast.html">RFC 21: OGR SQL type cast and field name alias</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc22_rpc.html">RFC 22: RPC Georeferencing</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc23_ogr_unicode.html">RFC 23.1: Unicode support in OGR</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc24_progressive_data_support.html">RFC 24: GDAL Progressive Data Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc25_fast_open.html">RFC 25: Fast Open</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc26_blockcache.html">RFC 26: GDAL Block Cache Improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc27_supportdata.html">RFC 27: Improved Supporting Data File Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc28_sqlfunc.html">RFC 28: OGR SQL Generalized Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc29_desired_fields.html">RFC 29: OGR Set Ignored Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc30_utf8_filenames.html">RFC 30: Unicode Filenames</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc31_ogr_64.html">RFC 31: OGR 64bit Integer Fields and FIDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc32_gdallocationinfo.html">RFC 32: gdallocationinfo utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc33_gtiff_pixelispoint.html">RFC 33: GTiff - Fixing PixelIsPoint Interpretation</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc34_license_policy.html">RFC 34: License Policy Enforcement</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc35_deletereorderalterfielddefn.html">RFC 35: Delete, reorder and alter field definitions of OGR layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc36_open_by_drivername.html">RFC 36: Allow specification of intended driver on GDALOpen</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc37_cplerror_userdata.html">RFC 37: User data callbacks in CPLError</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc38_ogr_faster_open.html">RFC 38: OGR Faster Open</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc39_ogr_layer_algebra.html">RFC 39: OGR Layer Algebra</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc40_enhanced_rat_support.html">RFC 40: Improving performance of Raster Attribute Table implementation for large tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc41_multiple_geometry_fields.html">RFC 41 : Support for multiple geometry fields in OGR</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc42_find_laundered_fields.html">RFC 42: OGR Layer laundered field lookup</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc43_getmetadatadomainlist.html">RFC 43: GDALMajorObject::GetMetadataDomainList</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc44_gdalinfoxml.html">RFC 44: Add Parseable Output Formats for ogrinfo and gdalinfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc45_virtualmem.html">RFC 45: GDAL datasets and raster bands as virtual memory mappings</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc46_gdal_ogr_unification.html">RFC 46: GDAL/OGR unification</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc47_dataset_caching.html">RFC 47: Per Dataset Caching and GDALRasterBand Multithreading</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc48_geographical_networks_support.html">RFC 48: Geographical networks support</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc49_curve_geometries.html">RFC 49: Curve geometries</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc50_ogr_field_subtype.html">RFC 50: OGR field subtypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc51_rasterio_resampling_progress.html">RFC 51: RasterIO() improvements : resampling and progress callback</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc52_strict_sql_quoting.html">RFC 52: Strict OGR SQL quoting</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc53_ogr_notnull_default.html">RFC 53: OGR not-null constraints and default values</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc54_dataset_transactions.html">RFC 54: Dataset transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc55_refined_setfeature_deletefeature_semantics.html">RFC 55: Refined SetFeature() and DeleteFeature() semantics</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc56_millisecond_precision.html">RFC 56: OFTTime/OFTDateTime millisecond accuracy</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc57_histogram_64bit_count.html">RFC 57: 64-bit bucket counts for histograms</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc58_removing_dataset_nodata_value.html">RFC 58: Removing Dataset Nodata Value</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc59.1_utilities_as_a_library.html">RFC 59.1 : GDAL/OGR utilities as a library</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc59_utilities_as_a_library.html">RFC 59 : GDAL/OGR utilities as a library</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc60_improved_roundtripping_in_ogr.html">RFC 60 : Improved round-tripping in OGR</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc61_support_for_measured_geometries.html">RFC 61 : Support for measured geometries</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc62_raster_algebra.html">RFC 62 : Raster algebra</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc63_sparse_datasets_improvements.html">RFC 63 : Sparse datasets improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc64_triangle_polyhedralsurface_tin.html">RFC 64: Triangle, Polyhedral surface and TIN</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc65_rfc7946_geojson.html">RFC 65: RFC 7946 GeoJSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc66_randomlayerreadwrite.html">RFC 66 : OGR random layer read/write capabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc67_nullfieldvalues.html">RFC 67 : Null values in OGR</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc68_cplusplus11.html">RFC 68: C++11 Compilation Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc69_cplusplus_formatting.html">RFC 69: C/C++ Code Formatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc70_output_format_guess.html">RFC 70: Guessing output format from output file name extension for utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc71_github_migration.html">RFC 71: Migration to GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc72_pytest.html">RFC 72: Update autotest suite to use pytest</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc73_proj6_wkt2_srsbarn.html">RFC 73: Integration of PROJ6 for WKT2, late binding capabilities, time-support and unified CRS database</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc74_sphinx.html">RFC 74: Migrate gdal.org to RTD-style Sphinx infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc75_multidimensional_arrays.html">RFC 75: Multidimensional arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc76_ogrpythondrivers.html">RFC 76: OGR Python drivers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">How to contribute?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GDAL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html"> GDAL  documentation </a> &raquo;</li>
      
          <li><a href="../index.html">Development</a> &raquo;</li>
      
          <li><a href="index.html">RFC list</a> &raquo;</li>
      
      <li>RFC 11: Fast Format Identification</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSGeo/gdal/edit//master/gdal/doc/source/development/rfc/rfc11_fastidentify.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="rfc12_filemanagement.html" class="btn btn-neutral float-right" title="RFC 12: Improved File Management" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rfc10_ogropen.html" class="btn btn-neutral float-left" title="RFC 10: OGR Open Parameters" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rfc-11-fast-format-identification">
<span id="rfc-11"></span><h1>RFC 11: Fast Format Identification<a class="headerlink" href="#rfc-11-fast-format-identification" title="Permalink to this headline">¶</a></h1>
<p>Author: Frank Warmerdam</p>
<p>Contact: <a class="reference external" href="mailto:warmerdam&#37;&#52;&#48;pobox&#46;com">warmerdam<span>&#64;</span>pobox<span>&#46;</span>com</a></p>
<p>Status: Adopted (and Implemented)</p>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>This RFC aims to add the ability for applications to quickly identify
what files in the file system are GDAL supported file formats without
necessarily opening any of them. It is mainly intended to allow GUI file
browsers based on file types.</p>
<p>This is accomplished by extending the GDALOpenInfo structure to hold
more directory context, and by adding an Identify() method on the
GDALDriver which a driver can implement to quickly identify that a file
is of a given format without doing a more expensive Open() operation.</p>
</div>
<div class="section" id="gdalopeninfo">
<h2>GDALOpenInfo<a class="headerlink" href="#gdalopeninfo" title="Permalink to this headline">¶</a></h2>
<p>The Open() (or Identify()) methods of many drivers need to probe for
files associated with the target file in order to open or identify a
file as being of a particular format. For instance, in order to open an
ESRI BIL file (EHDR driver) it is necessary to probe for a driver with
the same basename as the target file, but the extension .hdr. Currently
this is typically accomplished with VSIFStatL() calls or similar which
can be fairly expensive.</p>
<p>In order to reduce the need for such searches touch the operating system
file system machinery, the GDALOpenInfo structure will be extended to
hold an optional list of files. This is the list of all files at the
same level in the file system as the target file, including the target
file. The filenames will <em>not</em> include any path components, are an
essentially just the output of CPLReadDir() on the parent directory. If
the target object does not have filesystem semantics then the file list
should be NULL.</p>
<p>The following is added to GDALOpenInfo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">GDALOpenInfo</span><span class="p">(</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span> <span class="n">pszFile</span><span class="p">,</span> <span class="n">GDALAccess</span> <span class="n">eAccessIn</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span><span class="n">papszSiblings</span> <span class="p">);</span>
<span class="n">char</span> <span class="o">**</span><span class="n">papszSiblingFiles</span><span class="p">;</span>
</pre></div>
</div>
<p>The new constructor allows the file list to be passed in to populate the
papszSiblingFiles member (the argument will be copied). The existing
default constructor will use CPLGetDirname() to get the directory of the
passed pszFile, and CPLReadDir() to read the corresponding file list.
The new constructor is primarily aimed at efficient implementation of
the later GDALIdentifyDriver() function, avoiding re-reading the file
list for each file to be tested.</p>
</div>
<div class="section" id="identify">
<h2>Identify()<a class="headerlink" href="#identify" title="Permalink to this headline">¶</a></h2>
<p>The GDALDriver class will be extended with the following function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span>      <span class="p">(</span><span class="o">*</span><span class="n">pfnIdentify</span><span class="p">)(</span> <span class="n">GDALOpenInfo</span> <span class="o">*</span> <span class="p">);</span>
</pre></div>
</div>
<p>When implemented by a driver, the function is intended to return TRUE
(non-zero) if the driver determines that the file passed in via
GDALOpenInfo appears to be of the format the driver is implemented for.
To call this applications should call the new function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GDALDriverH</span> <span class="o">*</span><span class="n">GDALIdentifyDriver</span><span class="p">(</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">pszDatasource</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">papszDirFiles</span> <span class="p">);</span>
</pre></div>
</div>
<p>Internally GDALIdentifyDriver() will do the following</p>
<ol class="arabic simple">
<li><p>A GDALOpenInfo structure will be initialized based on pszDatasource
and papszDirFiles.</p></li>
<li><p>It will iterate over all drivers similarly to GDALOpen(). For each
driver it will use the pfnIdentify function if available, otherwise
it will use the pfnOpen() method to establish if the driver supports
the file.</p></li>
<li><p>It will return the driver handle for the first driver to respond
positively or NULL if none accept it.</p></li>
</ol>
</div>
<div class="section" id="driver-changes">
<h2>Driver Changes<a class="headerlink" href="#driver-changes" title="Permalink to this headline">¶</a></h2>
<p>In theory it is not necessary for any drivers to be modified, since
GDALIdentifyDriver() will fallback to using the pfnOpen function to
test. But in practice, no optimization is achieved unless at least some
drivers (hopefully those for which Open can be very expensive) are
updated. Part of the ongoing effort then is to implement identify
functions for GDAL drivers.</p>
<p>Generally speaking it should be easy to craft an identify function from
the initial test logic in the open function. For instance, the GeoTIFF
driver might be changed like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">GTiffDataset</span><span class="p">::</span><span class="n">Identify</span><span class="p">(</span> <span class="n">GDALOpenInfo</span> <span class="o">*</span> <span class="n">poOpenInfo</span> <span class="p">)</span>

<span class="p">{</span>
<span class="o">/*</span> <span class="o">--------------------------------------------------------------------</span> <span class="o">*/</span>
<span class="o">/*</span>      <span class="n">We</span> <span class="n">have</span> <span class="n">a</span> <span class="n">special</span> <span class="n">hook</span> <span class="k">for</span> <span class="n">handling</span> <span class="n">opening</span> <span class="n">a</span> <span class="n">specific</span>          <span class="o">*/</span>
<span class="o">/*</span>      <span class="n">directory</span> <span class="n">of</span> <span class="n">a</span> <span class="n">TIFF</span> <span class="n">file</span><span class="o">.</span>                                       <span class="o">*/</span>
<span class="o">/*</span> <span class="o">--------------------------------------------------------------------</span> <span class="o">*/</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">EQUALN</span><span class="p">(</span><span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pszFilename</span><span class="p">,</span><span class="s2">&quot;GTIFF_DIR:&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>

<span class="o">/*</span> <span class="o">--------------------------------------------------------------------</span> <span class="o">*/</span>
<span class="o">/*</span>  <span class="n">First</span> <span class="n">we</span> <span class="n">check</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">the</span> <span class="n">file</span> <span class="n">has</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">header</span>   <span class="o">*/</span>
<span class="o">/*</span>  <span class="nb">bytes</span><span class="o">.</span>                              <span class="o">*/</span>
<span class="o">/*</span> <span class="o">--------------------------------------------------------------------</span> <span class="o">*/</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">nHeaderBytes</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span> <span class="o">||</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;M&#39;</span> <span class="o">||</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;M&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">We</span> <span class="n">can</span><span class="s1">&#39;t support BigTIFF files for now.</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">43</span> <span class="o">&amp;&amp;</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>


    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x2A</span> <span class="o">||</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x2A</span> <span class="o">||</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pabyHeader</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The open might then be modified to use the identify function to avoid
duplicating the test logic.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GDALDataset *GTiffDataset::Open( GDALOpenInfo * poOpenInfo )

{
    TIFF    *hTIFF;

    if( !Identify( poOpenInfo ) )
        return NULL;

/* -------------------------------------------------------------------- */
/*      We have a special hook for handling opening a specific          */
/*      directory of a TIFF file.                                       */
/* -------------------------------------------------------------------- */
    if( EQUALN(poOpenInfo-&gt;pszFilename,&quot;GTIFF_DIR:&quot;,10) )
        return OpenDir( poOpenInfo-&gt;pszFilename );

    GTiffOneTimeInit();
...
</pre></div>
</div>
<p>Drivers which require header files such as the EHdr driver might
implement Identify() like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">EHdrDataset</span><span class="p">::</span><span class="n">Identify</span><span class="p">(</span> <span class="n">GDALOpenInfo</span> <span class="o">*</span> <span class="n">poOpenInfo</span> <span class="p">)</span>

<span class="p">{</span>
    <span class="nb">int</span>     <span class="n">i</span><span class="p">,</span> <span class="n">bSelectedHDR</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">char</span>  <span class="o">*</span><span class="n">pszHDRFilename</span><span class="p">;</span>

<span class="o">/*</span> <span class="o">--------------------------------------------------------------------</span> <span class="o">*/</span>
<span class="o">/*</span>  <span class="n">We</span> <span class="n">assume</span> <span class="n">the</span> <span class="n">user</span> <span class="ow">is</span> <span class="n">pointing</span> <span class="n">to</span> <span class="n">the</span> <span class="n">binary</span> <span class="p">(</span><span class="n">ie</span><span class="o">.</span> <span class="o">.</span><span class="n">bil</span><span class="p">)</span> <span class="n">file</span><span class="o">.</span>   <span class="o">*/</span>
<span class="o">/*</span> <span class="o">--------------------------------------------------------------------</span> <span class="o">*/</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">nHeaderBytes</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="o">/*</span> <span class="o">--------------------------------------------------------------------</span> <span class="o">*/</span>
<span class="o">/*</span>      <span class="n">Now</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">tear</span> <span class="n">apart</span> <span class="n">the</span> <span class="n">filename</span> <span class="n">to</span> <span class="n">form</span> <span class="n">a</span> <span class="o">.</span><span class="n">HDR</span>           <span class="o">*/</span>
<span class="o">/*</span>      <span class="n">filename</span><span class="o">.</span>                                                       <span class="o">*/</span>
<span class="o">/*</span> <span class="o">--------------------------------------------------------------------</span> <span class="o">*/</span>
    <span class="n">CPLString</span> <span class="n">osBasename</span> <span class="o">=</span> <span class="n">CPLGetBasename</span><span class="p">(</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">pszFilename</span> <span class="p">);</span>
    <span class="n">pszHDRFilename</span> <span class="o">=</span> <span class="n">CPLFormCIFilename</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">osBasename</span><span class="p">,</span> <span class="s2">&quot;hdr&quot;</span> <span class="p">);</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">CSLFindString</span><span class="p">(</span> <span class="n">poOpenInfo</span><span class="o">-&gt;</span><span class="n">papszSiblingFiles</span><span class="p">,</span> <span class="n">pszHDRFilename</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>During the initial implementation a variety of drivers will be updated,
including the following. As well some performance and file system
activity logging will be done to identify drivers that are currently
expensive.</p>
<ul class="simple">
<li><p>HFA</p></li>
<li><p>GTiff</p></li>
<li><p>JPEG</p></li>
<li><p>PNG</p></li>
<li><p>GIF</p></li>
<li><p>HDF4</p></li>
<li><p>DTED</p></li>
<li><p>USGS DEM</p></li>
<li><p>MrSID</p></li>
<li><p>JP2KAK</p></li>
<li><p>ECW</p></li>
<li><p>EHdr</p></li>
<li><p>RST</p></li>
</ul>
</div>
<div class="section" id="cplreaddir">
<h2>CPLReadDir()<a class="headerlink" href="#cplreaddir" title="Permalink to this headline">¶</a></h2>
<p>Currently the VSIMemFilesystemHandler implemented in cpl_vsi_mem.cpp
which provides “filesystem like” access to objects in memory does not
implement directory reading services. In order to properly populate the
directory listing this will need to be added.</p>
<p>To do this the CPLReadDir() function will also need to be reimplemented
to use VSIFilesystemHandler::ReadDir() instead of direct implementation
in cpl_dir.cpp. The win32 and unix/posix implementations of
VSIFilesystemHandler::ReadDir() already exist. This should essentially
complete the virtualization of filesystem access services.</p>
<p>CPLReadDir() will also be renamed VSIReadDir() but with a stub under the
old name available for backward compatibility.</p>
</div>
<div class="section" id="compatibility">
<h2>Compatibility<a class="headerlink" href="#compatibility" title="Permalink to this headline">¶</a></h2>
<p>There are no anticipated backward compatibility problems. However
forward compatibility will be affected, in that drivers updated in trunk
with the Identify function will not be able to be ported back into 1.4
builds and used their. Unmodified drivers, and externally maintained
drivers should not be impacted by this development.</p>
</div>
<div class="section" id="swig-implications">
<h2>SWIG Implications<a class="headerlink" href="#swig-implications" title="Permalink to this headline">¶</a></h2>
<p>The GDALIdentifyDriver() and VSIReadDir() functions will need to be
exposed via SWIG.</p>
</div>
<div class="section" id="regression-testing">
<h2>Regression Testing<a class="headerlink" href="#regression-testing" title="Permalink to this headline">¶</a></h2>
<p>A test script for the Identify() function will be added to the
autotest/gcore directory. It will include testing of identify in a
/vsimem memory collection.</p>
</div>
<div class="section" id="implementation-plan">
<h2>Implementation Plan<a class="headerlink" href="#implementation-plan" title="Permalink to this headline">¶</a></h2>
<p>The new features will be implemented by Frank Warmerdam in <em>trunk</em> for
the GDAL/OGR 1.5.0 release.</p>
</div>
<div class="section" id="performance-tests">
<h2>Performance Tests<a class="headerlink" href="#performance-tests" title="Permalink to this headline">¶</a></h2>
<p>A very quick test introducing the Identify without actually opening
changed the time to identify all files in a directory with 70 TIFF files
(on an NFS share) from 2 seconds to 0.5 seconds. So saving the overhead
of actually opening files can be significant for some formats, including
very common ones like GeoTIFF.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rfc12_filemanagement.html" class="btn btn-neutral float-right" title="RFC 12: Improved File Management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rfc10_ogropen.html" class="btn btn-neutral float-left" title="RFC 10: OGR Open Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <div class="info">
      <a class="logo-link" href="https://osgeo.org">
        <div class="osgeo-logo"></div>
      </a>
      <div class="copyright">
      

      &copy; 1998-2020 <a href="https://github.com/warmerdam">Frank Warmerdam</a>,
      <a href="https://github.com/rouault">Even Rouault</a>, and
      <a href="https://github.com/OSGeo/gdal/graphs/contributors">others</a>


      
      </div>
    </div>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>